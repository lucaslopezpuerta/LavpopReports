<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lavpop Analytics Dashboard - 2025-07-06 to
        2025-07-12</title>

    <!-- Load Google Charts globally -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- Enhanced CSS with improved print styles -->
    <style>
        /* CSS Custom Properties for Brand Consistency */
        :root {
            --primary-blue: #10306b;
            --secondary-blue: #1a4798;
            --accent-green: #6bbe4c;
            --light-green: #2ae01e;
            --background-light: #f8fafc;
            --background-white: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-light: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--background-light) 0%, #e2e8f0 100%);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Container & Layout */
        .dashboard-container {
            min-height: 100vh;
            background: var(--background-light);
        }

        .header {
            background: #10306B;
            background: linear-gradient(324deg, rgba(16, 48, 107, 1) 0%, rgba(26, 71, 152, 1) 70%);
            padding: 2rem 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .logo {
            max-width: 180px;
            height: auto;
            margin-bottom: 1.5rem;
            filter: brightness(1.1);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.025em;
        }

        .header h2 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.25rem;
            font-weight: 400;
            margin-bottom: 2rem;
        }

        .period-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow-md);
        }

        /* Navigation Bar Styles */
        .nav-bar {
            margin-top: 1.5rem;
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            text-decoration: none;
        }

        .archive-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-green);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 1rem;
            font-size: 0.9rem;
        }

        .archive-button:hover {
            background: #5aa83a;
            transform: translateY(-1px);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Section Styling */
        .section {
            background: var(--background-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .section-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-light);
            background: linear-gradient(135deg, var(--background-white) 0%, #f8fafc 100%);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .section-content {
            padding: 2rem;
        }

        /* Executive Summary */
        .executive-summary {
            background: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 100%);
            border: 1px solid #e879f9;
            position: relative;
        }

        .summary-text {
            background: var(--background-white);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent-green);
            box-shadow: var(--shadow-sm);
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--background-white);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-green) 0%, var(--light-green) 100%);
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .kpi-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.025em;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }

        .kpi-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .positive-change {
            color: #059669;
        }

        .negative-change {
            color: #dc2626;
        }

        .neutral-change {
            color: var(--text-secondary);
        }

        /* Chart Container */
        .chart-container {
            background: var(--background-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-light);
            position: relative;
        }

        .chart-header {
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid var(--border-light);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .chart-content {
            width: 100%;
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .chart-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: var(--text-secondary);
        }

        .chart-error {
            color: #dc2626;
            text-align: center;
            padding: 2rem;
        }

        /* Chart Grid Layouts */
        .chart-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-item {
            background: linear-gradient(135deg, var(--background-white) 0%, #f8fafc 100%);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .best-performance {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
        }

        .worst-performance {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
        }

        /* Customer Segments */
        .segment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .segment-card {
            background: var(--background-white);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .segment-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .segment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .segment-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .segment-badge {
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .customer-item:last-child {
            border-bottom: none;
        }

        .customer-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .customer-value {
            font-weight: 600;
            color: var(--accent-green);
        }

        /* Strategy Recommendations */
        .recommendation-grid {
            display: grid;
            gap: 1rem;
        }

        .recommendation-item {
            background: linear-gradient(135deg, var(--background-white) 0%, #f8fafc 100%);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            border-left: 4px solid var(--accent-green);
            box-shadow: var(--shadow-sm);
        }

        .recommendation-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .recommendation-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Footer */
        .footer {
            background: var(--primary-blue);
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        .footer a {
            color: #93c5fd;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 1rem;
            }

            .section-content {
                padding: 1rem;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .chart-grid-2 {
                grid-template-columns: 1fr;
            }

            .chart-content {
                min-height: 350px;
                padding: 0.5rem;
            }

            .nav-link {
                font-size: 0.875rem;
                padding: 0.4rem 0.8rem;
            }

            .archive-button {
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* Print Styles */
        @media print {
            @page {
                size: A4;
                margin: 1cm;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white !important;
                font-size: 10px !important;
                line-height: 1.3 !important;
            }

            .nav-bar,
            .archive-button {
                display: none !important;
            }

            .chart-content {
                height: 250px !important;
                min-height: 250px !important;
            }

            .section {
                page-break-inside: avoid;
                margin-bottom: 0.75rem !important;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Enhanced Header -->
        <header class="header">
            <div class="header-content">
                <img src="https://lavpop.com.br/assets/web/images/logos/logo-lavpop-site@2x.png" alt="Lavpop Logo"
                    class="logo">
                <h1>Weekly Analytics Dashboard</h1>
                <h2>Performance Report</h2>
                <div class="period-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z" />
                    </svg>
                    2025-07-06 to
                    2025-07-12
                </div>

                <!-- Navigation Bar with Archive Button -->
                <nav class="nav-bar">
                    <a href="index.html" class="nav-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                        </svg>
                        Home
                    </a>
                    <a href="data-tables.html" class="nav-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M3 3v18h18V3H3zm16 16H5V5h14v14zM7 7h2v2H7zM11 7h6v2h-6zM7 11h2v2H7zM11 11h6v2h-6zM7 15h2v2H7zM11 15h6v2h-6z" />
                        </svg>
                        Data Tables
                    </a>
                    <a href="archive/archived-dashboard-list.html" class="nav-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 4H2v16h20V6H12l-2-2z" />
                        </svg>
                        Archive
                    </a>
                    <button onclick="archiveDashboard()" class="archive-button">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                        </svg>
                        Save as PDF
                    </button>
                </nav>
            </div>
        </header>

        <main class="main-content">
            <!-- Executive Summary -->
            <section class="section executive-summary">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                        </svg>
                        Executive Summary
                    </h2>
                    <p class="section-subtitle">Key insights and performance highlights for the week</p>
                </div>
                <div class="section-content">
                    <div class="summary-text">
                        During the analyzed week, Lavpop Autosserviço Caxias do Sul experienced a moderate decline in overall performance compared to the previous period. There was a reduction in both revenue and the number of washing and drying cycles, which also led to a slight dip in equipment utilization. Despite the downturn, customer preference remained slightly more inclined toward wash cycles, and activity was strongest toward the end of the week, particularly on Friday and during the early evening hours, with 18:00 emerging as the peak time. In contrast, Tuesdays saw the lowest customer engagement. The weaker utilization during typically off-peak hours suggests potential opportunities for targeted promotions. Environmental factors showed that higher temperatures tended to deter visits, while rainfall may have had a mild positive influence on usage patterns. Overall, while demand softened during the week, identifiable patterns in customer behavior continue to offer valuable insights for operational and marketing strategies.
                    </div>

                    <!-- Enhanced KPI Grid -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Total Net Revenue</div>
                            <div class="kpi-value">R$4136.76</div>
                            <div class="kpi-change negative-change">
                                ↘
                                -17.3% vs Last Week
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-title">Total Cycles</div>
                            <div class="kpi-value">260</div>
                            <div class="kpi-change negative-change">
                                ↘
                                -15.3% vs Last Week
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-title">Overall Utilization</div>
                            <div class="kpi-value">20%</div>
                            <div class="kpi-change negative-change">
                                ↘
                                -3.5% vs Last Week
                            </div>
                        </div>


                    </div>
                </div>
            </section>

            <!-- Performance Overview -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
                        </svg>
                        Performance Overview
                    </h2>
                    <p class="section-subtitle">Revenue trends and comparative analysis</p>
                </div>
                <div class="section-content">
                    <!-- Key Performance Charts -->
                    <div class="chart-grid-2">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Weekly Performance Comparison</h3>
                            </div>
                            <div class="chart-content">
                                <div id="comparativePerformance" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Weekly Comparison...</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Current Week vs 4-Week Average Growth</h3>
                            </div>
                            <div class="chart-content">
                                <div id="weekVsAveragePerformance" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Growth Analysis...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Day of Week Analysis -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Revenue Distribution by Day of Week</h3>
                        </div>
                        <div class="chart-content">
                            <div id="dayofWeekRevenueDistribution" class="chart-loading">
                                <div class="spinner"></div>
                                <span>Loading Daily Revenue Distribution...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Best/Worst Day Stats -->
                    <div class="stats-grid">
                        <div class="stat-item best-performance">
                            <div class="stat-value">Friday</div>
                            <div class="stat-label">Best Day</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">R$966.9</div>
                            <div class="stat-label">Best Day Revenue</div>
                        </div>
                        <div class="stat-item worst-performance">
                            <div class="stat-value">Tuesday</div>
                            <div class="stat-label">Worst Day</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">R$240.96</div>
                            <div class="stat-label">Worst Day Revenue</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW: Wash vs Dry Analysis -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                        </svg>
                        Wash vs Dry Analysis
                    </h2>
                    <p class="section-subtitle">Service type performance comparison and optimization insights</p>
                </div>
                <div class="section-content">
                    <!-- Service Mix Overview -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Washer Cycles</div>
                            <div class="kpi-value">141</div>
                            <div class="kpi-change neutral-change">
                                54% of total</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Dryer Cycles</div>
                            <div class="kpi-value">119</div>
                            <div class="kpi-change neutral-change">
                                46% of total</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Washer Utilization</div>
                            <div class="kpi-value">22%</div>
                            <div class="kpi-change positive-change">
                                ↗
                                0.1% vs Last Week
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Dryer Utilization</div>
                            <div class="kpi-value">17%</div>
                            <div class="kpi-change negative-change">
                                ↘
                                -7.3% vs Last Week
                            </div>
                        </div>
                    </div>

                    <!-- Wash vs Dry Charts -->
                    <div class="chart-grid-2">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Wash vs Dry Service Performance</h3>
                            </div>
                            <div class="chart-content">
                                <div id="washVsDryServices" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Service Comparison...</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Wash vs Dry Utilization Comparison</h3>
                            </div>
                            <div class="chart-content">
                                <div id="washVsDryUtilization" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Utilization Comparison...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Wash vs Dry Week-over-Week Changes</h3>
                        </div>
                        <div class="chart-content">
                            <div id="washVsDryWeekOverWeek" class="chart-loading">
                                <div class="spinner"></div>
                                <span>Loading Week-over-Week Analysis...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW: Yearly Trends -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
                        </svg>
                        Long-term Trends
                    </h2>
                    <p class="section-subtitle">Monthly and yearly performance patterns</p>
                </div>
                <div class="section-content">
                    <div class="chart-grid-2">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Monthly Performance Trend</h3>
                            </div>
                            <div class="chart-content">
                                <div id="yearlyMonthlyTrend" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Monthly Trends...</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Weekly Performance Trend</h3>
                            </div>
                            <div class="chart-content">
                                <div id="yearlyWeeklyTrend" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Weekly Trends...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Customer Intelligence -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 7H16c-.8 0-1.54.37-2.01 1.01L12 10v8h2v4h8v-4h-2z" />
                        </svg>
                        Customer Insights
                    </h2>
                    <p class="section-subtitle">Customer behavior and segmentation analysis</p>
                </div>
                <div class="section-content">
                    <!-- Customer Metrics -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Average Services per Visit</div>
                            <div class="kpi-value">1.08</div>
                            <div class="kpi-change neutral-change">Customer usage pattern</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Average Visit Frequency</div>
                            <div class="kpi-value">3.4 visits/month</div>
                            <div class="kpi-change neutral-change">Visits per month</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">30-Day Return Rate</div>
                            <div class="kpi-value">18%</div>
                            <div class="kpi-change neutral-change">Customer retention</div>
                        </div>

                    </div>

                    <!-- Customer Analysis Charts -->
                    <div class="chart-grid-2">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Customer Segment Value Analysis</h3>
                            </div>
                            <div class="chart-content">
                                <div id="customerSegmentValuePyramid" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Customer Segments...</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Active vs Lapsed Customers</h3>
                            </div>
                            <div class="chart-content">
                                <div id="activeVsLapsed" class="chart-loading">
                                    <div class="spinner"></div>
                                    <span>Loading Customer Status...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Segments -->
                    <div class="segment-grid">
                        <div class="segment-card">
                            <div class="segment-header">
                                <h4 class="segment-title">Champions</h4>
                                <span class="segment-badge">70 customers</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Francisco Ricardo De Oliveira</span>
                                <span class="customer-value">R$2151.25</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Pedro Henrique Cerqueira Dias</span>
                                <span class="customer-value">R$2066.4</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">R$473.56</div>
                                <div class="stat-label">Average Value per Customer</div>
                            </div>
                        </div>

                        <div class="segment-card">
                            <div class="segment-header">
                                <h4 class="segment-title">Loyal Customers</h4>
                                <span class="segment-badge">90 customers</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Paola Padron</span>
                                <span class="customer-value">R$1181.39</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Gislaine Lamb</span>
                                <span class="customer-value">R$966.59</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">R$160.48</div>
                                <div class="stat-label">Average Value per Customer</div>
                            </div>
                        </div>

                        <div class="segment-card">
                            <div class="segment-header">
                                <h4 class="segment-title">Potential Customers</h4>
                                <span class="segment-badge">111 customers</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Israel Hofman</span>
                                <span class="customer-value">R$2597.35</span>
                            </div>
                            <div class="customer-item">
                                <span class="customer-name">Samuel Nunes</span>
                                <span class="customer-value">R$1378.41</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">R$125.66</div>
                                <div class="stat-label">Average Value per Customer</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Marketing & Payment Analysis -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                        </svg>
                        Marketing & Payments
                    </h2>
                    <p class="section-subtitle">Campaign performance and payment preferences</p>
                </div>
                <div class="section-content">
                    <!-- Marketing Metrics Grid -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">WhatsApp Messages Sent</div>
                            <div class="kpi-value">55</div>
                            <div class="kpi-change neutral-change">R$2.46 total cost</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Messages Total Cost</div>
                            <div class="kpi-value">R$2.46</div>
                            <div class="kpi-change neutral-change">Total cost in USD</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Top Coupon Revenue</div>
                            <div class="kpi-value">R$0</div>
                            <div class="kpi-change neutral-change">From "w100" (2 uses)</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Payment Method Distribution</h3>
                        </div>
                        <div class="chart-content">
                            <div id="paymentMethodDistribution" class="chart-loading">
                                <div class="spinner"></div>
                                <span>Loading Payment Methods...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SIMPLIFIED: Weather Impact -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.74 5.47c-.18-.38-.43-.73-.74-1.02l1.95-1.95c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41l-1.95 1.95c-.18-.36-.38-.68-.67-.39z" />
                        </svg>
                        Weather Impact
                    </h2>
                    <p class="section-subtitle">How weather patterns influence business performance</p>
                </div>
                <div class="section-content">
                    <!-- Key Weather Metrics -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Heat Index Correlation</div>
                            <div class="kpi-value">-0.44</div>
                            <div class="kpi-change negative-change">
                                xxxxx
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Yesterday Rain Impact</div>
                            <div class="kpi-value">0.25</div>
                            <div class="kpi-change positive-change">
                                vvvvvv
                            </div>
                        </div>
                    </div>

                    <!-- 7-Day Weather Forecast -->
                    <div style="background: var(--background-white); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border-light);">
                        <h4 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.25rem; font-weight: 600;">
                            7-Day Weather Forecast & Business Impact
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                            <!-- Day 1 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-19</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">10.4°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Clear</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Clear Day
                                </div>
                            </div>

                            <!-- Day 2 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-20</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">12.6°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Clear</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>

                            <!-- Day 3 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-21</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">13.4°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Clear</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>

                            <!-- Day 4 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-22</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">15°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Partially cloudy</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>

                            <!-- Day 5 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-23</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">12.2°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Overcast</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>

                            <!-- Day 6 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-24</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">9.7°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Rain, Overcast</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>

                            <!-- Day 7 -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); padding: 1rem; text-align: center; border: 1px solid #0ea5e9;">
                                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 0.5rem;">2025-07-25</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.25rem;">15.1°C</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Rain, Partially cloudy</div>
                                <div style="font-size: 0.75rem; color: var(--accent-green); font-weight: 600;">
                                    Rain ExpectedClear Day
                                </div>
                            </div>
                        </div>

                        <!-- Forecast Summary -->
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(42, 224, 30, 0.1); border-radius: var(--radius-md); border-left: 4px solid var(--accent-green);">
                            <strong style="color: var(--primary-blue);">Weekly Outlook:</strong>
                            <span style="color: var(--text-secondary);">
                                Average temperature 18.4°C. 
                                Clear weather may reduce demand - consider implementing promotional campaigns.
                            </span>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Basic Weather Correlations</h3>
                        </div>
                        <div class="chart-content">
                            <div id="simplifiedWeatherCorrelations" class="chart-loading">
                                <div class="spinner"></div>
                                <span>Loading Weather Impact...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Strategic Recommendations -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zM5 4v3H3V4c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v3h-2V4H5zm0 16h14v-3h2v3c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-3h2v3z" />
                        </svg>
                        Strategic Recommendations
                    </h2>
                    <p class="section-subtitle">Data-driven insights and actionable recommendations</p>
                </div>
                <div class="section-content">
                    <div class="recommendation-grid">
    <div class="recommendation-item">
        <div class="recommendation-title">Launch Off-Peak Hour Discounts to Boost Low Utilization</div>
        <div class="recommendation-text">
Introduce time-based discounts (e.g., 10% off) for wash or dry cycles during consistently underused off-peak hours, especially between 10 AM and 12 PM. This will help redistribute demand more evenly across the day and improve machine utilization, currently at just 20%, without increasing operational costs.
        </div>
    </div>
    <div class="recommendation-item">
        <div class="recommendation-title">Bundle Sales with Laundry Bags to Increase Cycle Volume per Visit</div>
        <div class="recommendation-text">
Offer a limited-time bundle where purchasing a laundry bag provides a discount coupon (e.g., 15%) for one wash or dry cycle. This encourages new and returning customers to increase the average cycles per visit, especially in segments like "Loyal" and "Potential" users already showing high engagement frequencies.
        </div>
    </div>
    <div class="recommendation-item">
        <div class="recommendation-title">Send Weather-Triggered WhatsApp Promotions on Rainy Days</div>
        <div class="recommendation-text">
Capitalize on the positive correlation between rainfall and usage by scheduling WhatsApp messages offering same-day cycle discounts when local forecasts predict rain. This real-time tactic can help drive short-term visits on days with higher natural demand, improving both revenue and visit frequency.
        </div>
    </div>
</div>
                </div>
            </section>
        </main>

        <!-- Enhanced Footer -->
        <footer class="footer">
            <div style="max-width: 1400px; margin: 0 auto;">
                <p style="font-size: 1.125rem; margin-bottom: 1rem;">
                    <strong>Lavpop Analytics</strong>
                </p>
                <p>© 2024 Lavpop. All rights reserved.</p>
                <p>Questions about this report? Contact Gabrielle Vilanova or Lucas López at
                    <a href="mailto:lavpop.caxias@outlook.com">lavpop.caxias@outlook.com</a>
                </p>
                <p style="margin-top: 1rem; opacity: 0.8;">
                    Generated on 2025-07-18T18:52:36.969Z | Powered by Nova Lopez Lavanderia Analytics Engine
                </p>
            </div>
        </footer>
    </div>

    <!-- Chart Embedding JavaScript -->
    <script type="text/javascript">
        // Updated configuration for streamlined charts
        const GITHUB_CONFIG = {
            baseUrl: 'https://raw.githubusercontent.com/lucaslopezpuerta/LavpopReports/main/charts/',
            charts: {
                // Core Performance Charts
                'comparativePerformance': 'comparative_performance.html',
                'weekVsAveragePerformance': 'week_vs_4Waverage_growth.html',
                'dayofWeekRevenueDistribution': 'day_of_week_revenue_distribution.html',

                // NEW: Wash vs Dry Analysis Charts
                'washVsDryServices': 'wash_vs_dry_services.html',
                'washVsDryUtilization': 'wash_vs_dry_utilization.html',
                'washVsDryWeekOverWeek': 'wash_vs_dry_week_over_week.html',

                // NEW: Yearly Trends Charts
                'yearlyMonthlyTrend': 'yearly_monthly_trend.html',
                'yearlyWeeklyTrend': 'yearly_weekly_trend.html',

                // Customer Intelligence Charts
                'customerSegmentValuePyramid': 'customer_segment_value_pyramid.html',
                'activeVsLapsed': 'active_vs_lapsed.html',

                // Marketing Charts
                'paymentMethodDistribution': 'payment_method_distribution.html',

                // SIMPLIFIED: Weather Impact
                'simplifiedWeatherCorrelations': 'simplified_weather_correlations.html'
            }
        };

        // Chart embedding functionality
        class ChartEmbedder {
            constructor() {
                this.loadedCharts = new Set();
                this.googleChartsLoaded = false;
                this.chartQueue = [];
                this.initGoogleCharts();
            }

            async initGoogleCharts() {
                try {
                    // Load all possible Google Charts packages
                    google.charts.load('current', {
                        'packages': ['corechart', 'bar', 'gauge', 'table', 'sankey', 'treemap', 'scatter', 'line', 'timeline']
                    });

                    google.charts.setOnLoadCallback(() => {
                        this.googleChartsLoaded = true;
                        console.log('Google Charts loaded successfully');
                        this.processChartQueue();
                    });
                } catch (error) {
                    console.error('Failed to load Google Charts:', error);
                    this.showGlobalError();
                }
            }

            processChartQueue() {
                // Process any charts that were queued while Google Charts was loading
                while (this.chartQueue.length > 0) {
                    const chartId = this.chartQueue.shift();
                    this.loadChart(chartId);
                }

                // Load all charts
                this.loadAllCharts();
            }

            async loadAllCharts() {
                const chartPromises = Object.keys(GITHUB_CONFIG.charts).map(chartId =>
                    this.loadChart(chartId)
                );

                try {
                    await Promise.all(chartPromises);
                    console.log('All charts loaded successfully');
                } catch (error) {
                    console.error('Some charts failed to load:', error);
                }
            }

            async loadChart(chartId) {
                if (this.loadedCharts.has(chartId)) {
                    return;
                }

                if (!this.googleChartsLoaded) {
                    // Queue the chart for loading once Google Charts is ready
                    if (!this.chartQueue.includes(chartId)) {
                        this.chartQueue.push(chartId);
                    }
                    return;
                }

                const chartElement = document.getElementById(chartId);
                if (!chartElement) {
                    console.warn(`Chart element with id "${chartId}" not found`);
                    return;
                }

                try {
                    // Show loading state
                    this.showLoading(chartElement);

                    // Fetch the chart HTML
                    const chartUrl = GITHUB_CONFIG.baseUrl + GITHUB_CONFIG.charts[chartId];
                    console.log(`Loading chart: ${chartId} from ${chartUrl}`);

                    const response = await fetch(chartUrl);

                    if (!response.ok) {
                        throw new Error(`Failed to fetch chart: ${response.status} - ${response.statusText}`);
                    }

                    const chartHtml = await response.text();

                    // Extract and execute the chart code
                    await this.extractAndExecuteChart(chartHtml, chartId);

                    this.loadedCharts.add(chartId);
                    console.log(`Successfully loaded chart: ${chartId}`);

                } catch (error) {
                    console.error(`Failed to load chart ${chartId}:`, error);
                    this.showError(chartElement, error.message, chartId);
                }
            }

            async extractAndExecuteChart(chartHtml, chartId) {
                try {
                    // Parse the HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(chartHtml, 'text/html');

                    // Extract the script content
                    const scripts = doc.querySelectorAll('script');
                    let chartScript = '';

                    for (const script of scripts) {
                        if (script.textContent && script.textContent.includes('drawChart')) {
                            chartScript = script.textContent;
                            break;
                        }
                    }

                    if (!chartScript) {
                        throw new Error('Chart script not found in HTML');
                    }

                    // Modify the script to use our chart container
                    const modifiedScript = this.modifyChartScript(chartScript, chartId);

                    // Execute the modified script
                    eval(modifiedScript);

                } catch (error) {
                    throw new Error(`Failed to extract chart code: ${error.message}`);
                }
            }

            modifyChartScript(scriptContent, chartId) {
                // Replace the chart_div reference with our specific chart ID
                let modified = scriptContent
                    .replace(/document\.getElementById\(['"]chart_div['"]\)/g, `document.getElementById('${chartId}')`)
                    .replace(/chart_div/g, chartId);

                // Simple fix: Replace fixed width values with responsive width
                modified = modified.replace(/["']width["']\s*:\s*\d+/g, '"width": "100%"');
                modified = modified.replace(/width:\s*\d+/g, 'width: "100%"');
                modified = modified.replace(/(var\s+options\s*=\s*{[^}]*?)["']title["']\s*:\s*["'][^"']*["']/g, '$1"title": ""');
                // Extract the drawChart function
                const drawChartMatch = modified.match(/function\s+drawChart\s*\(\s*\)\s*{[\s\S]*?(?=function\s+\w+|$)/);

                if (drawChartMatch) {
                    let drawChartFunction = drawChartMatch[0];

                    // Ensure the function ends properly
                    if (!drawChartFunction.trim().endsWith('}')) {
                        const braceCount = (drawChartFunction.match(/{/g) || []).length;
                        const closeBraceCount = (drawChartFunction.match(/}/g) || []).length;
                        const missingBraces = braceCount - closeBraceCount;

                        for (let i = 0; i < missingBraces; i++) {
                            drawChartFunction += '}';
                        }
                    }

                    // Simple responsive wrapper
                    return `
                        (function() {
                            try {
                                ${drawChartFunction}
                                
                                // Simple responsive override
                                const originalDrawChart = drawChart;
                                drawChart = function() {
                                    const container = document.getElementById('${chartId}');
                                    if (container && typeof options !== 'undefined') {
                                        const containerWidth = container.offsetWidth || 600;
                                        options.width = Math.max(containerWidth - 20, 300);
                                        if (options.chartArea) {
                                            options.chartArea.width = '85%';
                                        }
                                    }
                                    originalDrawChart();
                                };
                                
                                if (typeof google !== 'undefined' && google.charts) {
                                    drawChart();
                                } else {
                                    throw new Error('Google Charts not available');
                                }
                            } catch (error) {
                                console.error('Error executing chart ${chartId}:', error);
                                const element = document.getElementById('${chartId}');
                                if (element) {
                                    element.innerHTML = '<div class="chart-error"><h4>Chart Error</h4><p>' + error.message + '</p></div>';
                                }
                            }
                        })();
                    `;
                }

                // Fallback: execute with simple width fix
                return `
                    (function() {
                        try {
                            ${modified}
                        } catch (error) {
                            console.error('Error executing chart ${chartId}:', error);
                            const element = document.getElementById('${chartId}');
                            if (element) {
                                element.innerHTML = '<div class="chart-error"><h4>Chart Error</h4><p>' + error.message + '</p></div>';
                            }
                        }
                    })();
                `;
            }

            showLoading(element) {
                element.innerHTML = `
                    <div class="chart-loading">
                        <div class="spinner"></div>
                        <span>Loading chart...</span>
                    </div>
                `;
            }

            showError(element, message, chartId) {
                element.innerHTML = `
                    <div class="chart-error">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="#dc2626">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"/>
                        </svg>
                        <h4>Failed to load chart</h4>
                        <p style="font-size: 0.875rem; margin: 0.5rem 0;">${message}</p>
                        <button onclick="chartEmbedder.refreshChart('${chartId}')" style="
                            background: var(--primary-blue); 
                            color: white; 
                            border: none; 
                            padding: 0.5rem 1rem; 
                            border-radius: 0.25rem; 
                            cursor: pointer;
                            margin-top: 1rem;
                            font-size: 0.875rem;
                        ">Retry</button>
                    </div>
                `;
            }

            showGlobalError() {
                const allChartElements = document.querySelectorAll('[id*="chart"], [class*="chart-loading"]');
                allChartElements.forEach(element => {
                    if (element.classList.contains('chart-loading') || element.id) {
                        this.showError(element, 'Google Charts failed to load', 'global');
                    }
                });
            }

            // Method to refresh a specific chart
            async refreshChart(chartId) {
                this.loadedCharts.delete(chartId);
                // Clear any existing resize timer for this chart
                if (window[`resizeTimer_${chartId}`]) {
                    clearTimeout(window[`resizeTimer_${chartId}`]);
                }
                await this.loadChart(chartId);
            }

            // Method to refresh all charts
            async refreshAllCharts() {
                this.loadedCharts.clear();
                // Clear all resize timers
                Object.keys(GITHUB_CONFIG.charts).forEach(chartId => {
                    if (window[`resizeTimer_${chartId}`]) {
                        clearTimeout(window[`resizeTimer_${chartId}`]);
                    }
                });
                await this.loadAllCharts();
            }
        }

        // Initialize the chart embedder when the page loads
        let chartEmbedder;
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing chart embedder...');
            chartEmbedder = new ChartEmbedder();
        });

        // Utility function to manually trigger chart refresh
        function refreshCharts() {
            if (chartEmbedder) {
                chartEmbedder.refreshAllCharts();
            }
        }

        // Handle window resize for chart responsiveness
        let resizeTimer;
        window.addEventListener('resize', function () {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // Trigger individual chart resize functions if they exist
                Object.keys(GITHUB_CONFIG.charts).forEach(chartId => {
                    if (typeof window[`drawChart_${chartId}`] === 'function') {
                        try {
                            window[`drawChart_${chartId}`]();
                        } catch (e) {
                            console.warn(`Failed to resize chart ${chartId}:`, e);
                        }
                    }
                });
            }, 300);
        });

        // Optional: Auto-refresh charts every 30 minutes to get latest data
        setInterval(() => {
            if (chartEmbedder && document.visibilityState === 'visible') {
                console.log('Auto-refreshing charts...');
                chartEmbedder.refreshAllCharts();
            }
        }, 30 * 60 * 1000); // 30 minutes

        // Handle page visibility changes
        document.addEventListener('visibilitychange', function () {
            if (document.visibilityState === 'visible' && chartEmbedder) {
                // Just resize existing charts when page becomes visible instead of full refresh
                setTimeout(() => {
                    Object.keys(GITHUB_CONFIG.charts).forEach(chartId => {
                        if (typeof window[`drawChart_${chartId}`] === 'function') {
                            try {
                                window[`drawChart_${chartId}`]();
                            } catch (e) {
                                console.warn(`Failed to resize chart ${chartId}:`, e);
                            }
                        }
                    });
                }, 500);
            }
        });

        // Print optimization
        window.addEventListener('beforeprint', function () {
            document.body.style.fontSize = '12px';
        });

        window.addEventListener('afterprint', function () {
            document.body.style.fontSize = '';
        });

        // Add smooth scrolling for anchor links
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });

        // Performance monitoring
        window.addEventListener('load', function () {
            console.log('Dashboard loaded successfully');

            // Log performance metrics
            if (window.performance && window.performance.timing) {
                const timing = window.performance.timing;
                const loadTime = timing.loadEventEnd - timing.navigationStart;
                console.log(`Total load time: ${loadTime}ms`);
            }
        });

        // Error handling for global JavaScript errors 
        window.addEventListener('error', function (e) {
            console.error('Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', function (e) {
            console.error('Unhandled promise rejection:', e.reason);
        });
    </script>
</body>
</html>